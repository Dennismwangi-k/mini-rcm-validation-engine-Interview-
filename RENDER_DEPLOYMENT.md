# Render Deployment Guide

This guide will help you deploy the RCM Validation Engine to Render.

## üìã Prerequisites

1. **Render Account**: Sign up at [render.com](https://render.com)
2. **GitHub Repository**: Push your code to GitHub
3. **OpenAI API Key** (optional): For LLM validation features

## üöÄ Quick Deploy (Using Blueprint)

### Option 1: One-Click Deploy with Blueprint

1. **Connect GitHub Repository**
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New +" ‚Üí "Blueprint"
   - Connect your GitHub repository
   - Select the repository containing this project

2. **Render will automatically:**
   - Create PostgreSQL database
   - Create Redis instance
   - Deploy Django backend
   - Deploy Celery worker
   - Deploy React frontend

3. **Configure Environment Variables:**
   After deployment, go to each service and add:
   
   **Backend Service:**
   - `OPENAI_API_KEY` (optional): Your OpenAI API key
   - `SECRET_KEY`: Auto-generated by Render (or set custom)
   - `DEBUG`: Set to `False` for production
   
   **Frontend Service:**
   - `REACT_APP_API_URL`: Update to your backend URL (e.g., `https://rcm-backend.onrender.com/api`)

4. **Run Migrations:**
   - Go to backend service ‚Üí Shell
   - Run: `python manage.py migrate`
   - Run: `python manage.py createsuperuser` (optional)

## üîß Manual Deployment (Step-by-Step)

### Step 1: Create PostgreSQL Database

1. Go to Render Dashboard ‚Üí "New +" ‚Üí "PostgreSQL"
2. Name: `rcm-database`
3. Plan: Starter ($7/month)
4. Click "Create Database"
5. **Save the Internal Database URL** (you'll need it)

### Step 2: Create Redis Instance

1. Go to Render Dashboard ‚Üí "New +" ‚Üí "Redis"
2. Name: `rcm-redis`
3. Plan: Starter ($7/month)
4. Click "Create Redis"
5. **Save the Internal Redis URL** (you'll need it)

### Step 3: Deploy Django Backend

1. Go to Render Dashboard ‚Üí "New +" ‚Üí "Web Service"
2. Connect your GitHub repository
3. Configure:
   - **Name**: `rcm-backend`
   - **Root Directory**: `backend`
   - **Environment**: `Python 3`
   - **Build Command**: 
     ```bash
     pip install -r requirements.txt && python manage.py collectstatic --noinput
     ```
   - **Start Command**: 
     ```bash
     gunicorn rcm_project.wsgi:application --bind 0.0.0.0:$PORT
     ```

4. **Environment Variables:**
   ```
   PYTHON_VERSION=3.9.18
   DATABASE_URL=<from PostgreSQL service>
   CELERY_BROKER_URL=<from Redis service>
   CELERY_RESULT_BACKEND=<from Redis service>
   SECRET_KEY=<generate a secure key>
   DEBUG=False
   ALLOWED_HOSTS=rcm-backend.onrender.com,*.onrender.com
   CORS_ALLOWED_ORIGINS=https://rcm-frontend.onrender.com
   OPENAI_API_KEY=<your OpenAI key, optional>
   ```

5. Click "Create Web Service"

6. **After deployment, run migrations:**
   - Go to backend service ‚Üí Shell
   - Run: `python manage.py migrate`
   - Run: `python manage.py createsuperuser` (optional)

### Step 4: Deploy Celery Worker

1. Go to Render Dashboard ‚Üí "New +" ‚Üí "Background Worker"
2. Connect your GitHub repository
3. Configure:
   - **Name**: `rcm-celery-worker`
   - **Root Directory**: `backend`
   - **Environment**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `celery -A rcm_project worker -l info`

4. **Environment Variables:**
   ```
   PYTHON_VERSION=3.9.18
   DATABASE_URL=<same as backend>
   CELERY_BROKER_URL=<same as backend>
   CELERY_RESULT_BACKEND=<same as backend>
   SECRET_KEY=<same as backend>
   DEBUG=False
   OPENAI_API_KEY=<same as backend>
   ```

5. Click "Create Background Worker"

### Step 5: Deploy React Frontend

1. Go to Render Dashboard ‚Üí "New +" ‚Üí "Static Site"
2. Connect your GitHub repository
3. Configure:
   - **Name**: `rcm-frontend`
   - **Root Directory**: `frontend`
   - **Build Command**: `npm install && npm run build`
   - **Publish Directory**: `build`

4. **Environment Variables:**
   ```
   NODE_VERSION=18.20.0
   REACT_APP_API_URL=https://rcm-backend.onrender.com/api
   ```

5. Click "Create Static Site"

## üìù Required Files for Render

Make sure these files exist in your repository:

### 1. `render.yaml` (Blueprint file)
   - Already created in project root
   - Defines all services and their configuration

### 2. `backend/requirements.txt`
   - Must include `gunicorn` for production server
   - Must include `dj-database-url` for database parsing

### 3. `backend/Procfile` (Alternative to render.yaml)
   ```procfile
   web: gunicorn rcm_project.wsgi:application --bind 0.0.0.0:$PORT
   ```

## üîê Environment Variables Summary

### Backend Service
| Variable | Value | Notes |
|----------|-------|-------|
| `DATABASE_URL` | Auto from PostgreSQL | Internal connection string |
| `CELERY_BROKER_URL` | Auto from Redis | Internal Redis URL |
| `CELERY_RESULT_BACKEND` | Auto from Redis | Internal Redis URL |
| `SECRET_KEY` | Generate | Use Render's generator or custom |
| `DEBUG` | `False` | Production mode |
| `ALLOWED_HOSTS` | `rcm-backend.onrender.com,*.onrender.com` | Your backend URL |
| `CORS_ALLOWED_ORIGINS` | `https://rcm-frontend.onrender.com` | Your frontend URL |
| `OPENAI_API_KEY` | Your key | Optional |

### Celery Worker
| Variable | Value | Notes |
|----------|-------|-------|
| `DATABASE_URL` | Same as backend | |
| `CELERY_BROKER_URL` | Same as backend | |
| `CELERY_RESULT_BACKEND` | Same as backend | |
| `SECRET_KEY` | Same as backend | |
| `DEBUG` | `False` | |
| `OPENAI_API_KEY` | Same as backend | Optional |

### Frontend Service
| Variable | Value | Notes |
|----------|-------|-------|
| `REACT_APP_API_URL` | `https://rcm-backend.onrender.com/api` | Your backend API URL |
| `NODE_VERSION` | `18.20.0` | Node.js version |

## üõ†Ô∏è Post-Deployment Steps

1. **Update Frontend API URL:**
   - After backend deploys, update `REACT_APP_API_URL` in frontend service
   - Rebuild frontend service

2. **Run Database Migrations:**
   ```bash
   # In backend service shell
   python manage.py migrate
   python manage.py createsuperuser
   ```

3. **Test the Application:**
   - Visit your frontend URL
   - Register a new account
   - Upload a claims file
   - Verify validation works

## üîç Troubleshooting

### Backend Issues

**Database Connection Error:**
- Verify `DATABASE_URL` is set correctly
- Check PostgreSQL service is running
- Ensure database name matches

**Static Files Not Loading:**
- Run `python manage.py collectstatic` in shell
- Check `STATIC_ROOT` in settings.py

**CORS Errors:**
- Update `CORS_ALLOWED_ORIGINS` with your frontend URL
- Restart backend service

### Celery Issues

**Tasks Not Processing:**
- Verify Redis connection strings
- Check Celery worker logs
- Ensure worker service is running

### Frontend Issues

**API Connection Failed:**
- Verify `REACT_APP_API_URL` is correct
- Check backend service is running
- Ensure CORS is configured

**Build Fails:**
- Check Node.js version (18.20.0)
- Verify all dependencies in package.json
- Check build logs for errors

## üìä Service URLs

After deployment, you'll have:
- **Frontend**: `https://rcm-frontend.onrender.com`
- **Backend API**: `https://rcm-backend.onrender.com`
- **Health Check**: `https://rcm-backend.onrender.com/health/`
- **Admin Panel**: `https://rcm-backend.onrender.com/admin/`

## üí∞ Pricing Estimate

- **PostgreSQL**: $7/month (Starter plan)
- **Redis**: $7/month (Starter plan)
- **Backend Web Service**: Free tier available (or $7/month)
- **Celery Worker**: Free tier available (or $7/month)
- **Frontend Static Site**: Free

**Total**: ~$14-28/month (depending on plan choices)

## üîÑ Updating Deployment

1. **Push changes to GitHub**
2. Render automatically detects changes
3. Services rebuild and redeploy automatically
4. Check deployment logs for any issues

## üìû Support

If you encounter issues:
1. Check service logs in Render dashboard
2. Verify environment variables are set correctly
3. Ensure all services are running
4. Check database and Redis connections

---

**Ready to deploy?** Follow the Quick Deploy section above or use the manual steps for more control!

